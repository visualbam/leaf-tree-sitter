================================================================================
Complex template with chained methods and arithmetic
================================================================================

<div class="user-stats">
    <h3>User Statistics</h3>
    <p>Total Users: #(users.count)</p>
    <p>Active Users: #(users.filter(isActive).count)</p>
    <p>Average Age: #(users.map(age).average())</p>

    #if(users.count > 0)
        <p>Users per page: #(users.count / 10)</p>
        <p>Discount eligible: #(users.filter(age >= 65).count)</p>
    #endif
</div>

--------------------------------------------------------------------------------

(template
  (html_element
    (start_tag
      (tag_name)
      (attribute
        (attribute_name)
        (quoted_attribute_value
          (attribute_value))))
    (html_content
      (html_element
        (start_tag
          (tag_name))
        (html_content
          (text))
        (end_tag
          (tag_name)))
      (html_element
        (start_tag
          (tag_name))
        (html_content
          (text)
          (leaf_variable
            (expression
              (postfix_expression
                (member_expression
                  (postfix_expression
                    (primary_expression
                      (identifier)))
                  (identifier))))))
        (end_tag
          (tag_name)))
      (html_element
        (start_tag
          (tag_name))
        (html_content
          (text)
          (leaf_variable
            (expression
              (postfix_expression
                (member_expression
                  (postfix_expression
                    (call_expression
                      (postfix_expression
                        (member_expression
                          (postfix_expression
                            (primary_expression
                              (identifier)))
                          (identifier)))
                      (argument_list
                        (expression
                          (postfix_expression
                            (primary_expression
                              (identifier)))))))
                  (identifier))))))
        (end_tag
          (tag_name)))
      (html_element
        (start_tag
          (tag_name))
        (html_content
          (text)
          (leaf_variable
            (expression
              (postfix_expression
                (call_expression
                  (postfix_expression
                    (member_expression
                      (postfix_expression
                        (call_expression
                          (postfix_expression
                            (member_expression
                              (postfix_expression
                                (primary_expression
                                  (identifier)))
                              (identifier)))
                          (argument_list
                            (expression
                              (postfix_expression
                                (primary_expression
                                  (identifier)))))))
                      (identifier))))))))
        (end_tag
          (tag_name)))
      (leaf_directive
        (if_directive
          (if_header
            (expression
              (binary_expression
                (expression
                  (postfix_expression
                    (member_expression
                      (postfix_expression
                        (primary_expression
                          (identifier)))
                      (identifier))))
                (expression
                  (postfix_expression
                    (primary_expression
                      (number_literal)))))))
          (html_content
            (html_element
              (start_tag
                (tag_name))
              (html_content
                (text)
                (leaf_variable
                  (expression
                    (binary_expression
                      (expression
                        (postfix_expression
                          (member_expression
                            (postfix_expression
                              (primary_expression
                                (identifier)))
                            (identifier))))
                      (expression
                        (postfix_expression
                          (primary_expression
                            (number_literal))))))))
              (end_tag
                (tag_name)))
            (html_element
              (start_tag
                (tag_name))
              (html_content
                (text)
                (leaf_variable
                  (expression
                    (postfix_expression
                      (member_expression
                        (postfix_expression
                          (call_expression
                            (postfix_expression
                              (member_expression
                                (postfix_expression
                                  (primary_expression
                                    (identifier)))
                                (identifier)))
                            (argument_list
                              (expression
                                (binary_expression
                                  (expression
                                    (postfix_expression
                                      (primary_expression
                                        (identifier))))
                                  (expression
                                    (postfix_expression
                                      (primary_expression
                                        (number_literal)))))))))
                        (identifier))))))
              (end_tag
                (tag_name))))
          (end_if_directive))))
    (end_tag
      (tag_name))))